version: 2

models:
  - name: int_session_metrics_by_campaign
    description: |
      Aggregated session metrics grouped by campaign and date.
      This intermediate model calculates key session performance indicators
      including engagement, device distribution, and user counts.
      Used by: campaign_performance
    columns:
      - name: campaign_id
        description: Unique identifier for the campaign
        data_tests:
          - not_null
      - name: date
        description: Date of the sessions
        data_tests:
          - not_null
      - name: total_sessions
        description: Total number of distinct sessions
      - name: unique_users
        description: Count of distinct users who had sessions
      - name: avg_session_duration
        description: Average session duration in seconds
      - name: avg_pages_per_session
        description: Average number of pages viewed per session
      - name: engaged_sessions
        description: Number of sessions classified as engaged
      - name: mobile_sessions
        description: Number of sessions from mobile devices
      - name: desktop_sessions
        description: Number of sessions from desktop devices

  - name: int_conversion_metrics_by_campaign
    description: |
      Aggregated conversion metrics grouped by campaign and date.
      This intermediate model calculates revenue and conversion counts
      attributed to each campaign.
      Used by: campaign_performance
    columns:
      - name: campaign_id
        description: Unique identifier for the campaign (from attributed_campaign_id)
        data_tests:
          - not_null
      - name: date
        description: Date of the conversions
        data_tests:
          - not_null
      - name: total_conversions
        description: Total number of distinct conversions
      - name: converting_users
        description: Count of distinct users who converted
      - name: total_revenue
        description: Sum of all conversion values in dollars
      - name: avg_order_value
        description: Average conversion value (revenue per conversion)

  - name: int_user_touchpoint_summary
    description: |
      User-level aggregation of all touchpoints in their journey.
      Summarizes the breadth (campaigns/channels) and length (days) of each user's journey.
      Used by: user_journey
    columns:
      - name: user_id
        description: Unique identifier for the user
        data_tests:
          - not_null
          - unique
      - name: total_touchpoints
        description: Total number of distinct touchpoints for this user
      - name: total_sessions
        description: Total number of distinct sessions for this user
      - name: campaigns_touched
        description: Number of distinct campaigns the user interacted with
      - name: channels_used
        description: Number of distinct channels the user came from
      - name: first_touch_date
        description: Timestamp of the user's first touchpoint
      - name: last_touch_date
        description: Timestamp of the user's most recent touchpoint
      - name: journey_length_days
        description: Number of days between first and last touchpoint

  - name: int_user_conversions
    description: |
      User-level aggregation of all conversions.
      Summarizes conversion behavior and value per user.
      Used by: user_journey
    columns:
      - name: user_id
        description: Unique identifier for the user
        data_tests:
          - not_null
          - unique
      - name: total_conversions
        description: Total number of conversions for this user
      - name: total_conversion_value
        description: Sum of all conversion values for this user in dollars
      - name: first_conversion_date
        description: Timestamp of the user's first conversion
      - name: last_conversion_date
        description: Timestamp of the user's most recent conversion

  - name: int_converting_user_touchpoints
    description: |
      All touchpoints for users who eventually converted, joined with conversion data.
      Includes window functions to identify first and last touchpoints per conversion.
      Used by: int_channel_attribution_calc
    columns:
      - name: user_id
        description: Unique identifier for the user
      - name: channel
        description: Marketing channel of this touchpoint
      - name: touchpoint_position
        description: Position of this touchpoint in the user's journey
      - name: campaign_id
        description: Campaign associated with this touchpoint
      - name: touchpoint_timestamp
        description: When this touchpoint occurred
      - name: conversion_id
        description: Unique identifier for the conversion
      - name: conversion_value
        description: Value of the conversion in dollars
      - name: conversion_timestamp
        description: When the conversion occurred
      - name: first_position
        description: The first touchpoint position for this conversion (window function)
      - name: last_position
        description: The last touchpoint position for this conversion (window function)

  - name: int_channel_attribution_calc
    description: |
      Attribution calculations applying different models (first-touch, last-touch, linear).
      Assigns conversion credit to channels based on touchpoint position.
      Used by: channel_attribution
    columns:
      - name: channel
        description: Marketing channel receiving attribution credit
      - name: conversion_id
        description: Unique identifier for the conversion
      - name: conversion_value
        description: Total value of the conversion in dollars
      - name: first_touch_value
        description: |
          Attribution value using first-touch model.
          Full conversion value if this is the first touchpoint, else 0.
      - name: last_touch_value
        description: |
          Attribution value using last-touch model.
          Full conversion value if this is the last touchpoint, else 0.
      - name: linear_value
        description: |
          Attribution value using linear model.
          Conversion value divided equally among all touchpoints.
