version: 2

models:
  - name: campaign_performance
    description: |
      Complete campaign performance fact table combining spend, impressions, clicks,
      sessions, and conversions. This is the primary table for analyzing campaign ROI
      and performance metrics.

      Grain: One row per campaign per date

      Key metrics:
      - Advertising metrics (spend, impressions, clicks, CTR, CPC)
      - Session metrics (sessions, users, engagement, device breakdown)
      - Conversion metrics (conversions, revenue, AOV)
      - Calculated KPIs (conversion rate, ROAS, CPA, click-to-session rate)
    columns:
      - name: campaign_id
        description: Unique identifier for the campaign
        data_tests:
          - not_null
      - name: date
        description: Date of the performance metrics
        data_tests:
          - not_null
      - name: campaign_name
        description: Name of the campaign
      - name: channel
        description: Marketing channel (Meta, Google Ads, LinkedIn, etc.)
      - name: status
        description: Campaign status (active, paused, etc.)

      # Spend metrics
      - name: daily_budget
        description: Daily budget allocated for the campaign in dollars
      - name: spend
        description: Actual amount spent on the campaign in dollars

      # Impression & Click metrics
      - name: impressions
        description: Number of ad impressions served
      - name: clicks
        description: Number of clicks on ads
      - name: ctr
        description: Click-through rate (clicks / impressions)
      - name: cpc
        description: Cost per click in dollars

      # Session metrics
      - name: total_sessions
        description: Total number of website sessions from this campaign
      - name: unique_users
        description: Number of unique users who had sessions
      - name: avg_session_duration
        description: Average session duration in seconds
      - name: avg_pages_per_session
        description: Average number of pages viewed per session
      - name: engaged_sessions
        description: Number of sessions classified as engaged
      - name: mobile_sessions
        description: Number of sessions from mobile devices
      - name: desktop_sessions
        description: Number of sessions from desktop devices

      # Conversion metrics
      - name: total_conversions
        description: Total number of conversions attributed to this campaign
      - name: converting_users
        description: Number of unique users who converted
      - name: total_revenue
        description: Total revenue from conversions in dollars
      - name: avg_order_value
        description: Average order value (revenue per conversion)

      # Calculated KPIs
      - name: conversion_rate
        description: Conversion rate (conversions / sessions)
      - name: roas
        description: Return on ad spend (revenue / spend)
      - name: cost_per_conversion
        description: Cost per acquisition - spend divided by conversions
      - name: click_to_session_rate
        description: Rate of clicks that resulted in sessions

  - name: daily_summary
    description: |
      Daily rollup summary fact table aggregating all campaign performance
      across the entire business. Provides a high-level view of marketing
      performance over time.

      Grain: One row per date

      Key metrics:
      - Campaign and channel activity levels
      - Total spend and budget utilization
      - Aggregate advertising performance
      - Overall session and user engagement
      - Total conversions and revenue
      - Portfolio-level KPIs (conversion rate, ROAS, CPA)
    columns:
      - name: date
        description: Date of the summary metrics
        data_tests:
          - not_null
          - unique

      # Campaign metrics
      - name: active_campaigns
        description: Number of distinct campaigns active on this date
      - name: active_channels
        description: Number of distinct channels with activity

      # Spend metrics
      - name: total_spend
        description: Total amount spent across all campaigns in dollars
      - name: total_budget
        description: Total budget allocated across all campaigns
      - name: budget_utilization
        description: Percentage of budget actually spent (spend / budget)

      # Impression & Click metrics
      - name: total_impressions
        description: Total ad impressions across all campaigns
      - name: total_clicks
        description: Total clicks across all campaigns
      - name: avg_ctr
        description: Average click-through rate across campaigns
      - name: avg_cpc
        description: Average cost per click across campaigns

      # Session metrics
      - name: total_sessions
        description: Total website sessions from all campaigns
      - name: total_users
        description: Total unique users across all campaigns
      - name: avg_session_duration
        description: Average session duration in seconds
      - name: avg_pages_per_session
        description: Average pages viewed per session

      # Conversion metrics
      - name: total_conversions
        description: Total conversions across all campaigns
      - name: total_revenue
        description: Total revenue from all conversions in dollars
      - name: avg_order_value
        description: Average order value across all conversions

      # Calculated KPIs
      - name: overall_conversion_rate
        description: Overall conversion rate (total conversions / total sessions)
      - name: overall_roas
        description: Overall return on ad spend (total revenue / total spend)
      - name: overall_cpa
        description: Overall cost per acquisition (total spend / total conversions)

  - name: customer_lifetime_value
    description: |
      Customer lifetime value with acquisition channel and tier segmentation.
      Answers: "How much is each customer worth and where did they come from?"

      Grain: One row per user_id
    columns:
      - name: user_id
        description: Unique identifier for the customer
        data_tests:
          - not_null
          - unique
      - name: total_revenue
        description: Total conversion value across all purchases
      - name: total_orders
        description: Number of distinct purchases
      - name: first_purchase_date
        description: Date of the customer's first purchase
      - name: last_purchase_date
        description: Date of the customer's most recent purchase
      - name: acquisition_channel
        description: Channel of the customer's earliest first-touch attribution touchpoint
      - name: ltv_tier
        description: "Customer segment: high ($500+), medium ($100-499), low (under $100)"

  - name: campaign_funnel_analysis
    description: |
      Campaign funnel with stage-to-stage conversion rates and efficiency score.
      Answers: "Where are we losing people in the funnel, per campaign?"

      Grain: One row per campaign_id
    columns:
      - name: campaign_id
        description: Unique identifier for the campaign
        data_tests:
          - not_null
          - unique
      - name: campaign_name
        description: Name of the campaign
      - name: channel
        description: Marketing channel
      - name: total_impressions
        description: Total impressions across all dates
      - name: total_clicks
        description: Total clicks across all dates
      - name: total_sessions
        description: Total sessions attributed to this campaign
      - name: total_conversions
        description: Total conversions attributed to this campaign
      - name: total_revenue
        description: Total revenue from conversions
      - name: impression_to_click_rate
        description: Click-through rate (clicks / impressions)
      - name: click_to_session_rate
        description: Rate of clicks that became sessions
      - name: session_to_conversion_rate
        description: Rate of sessions that converted
      - name: efficiency_score
        description: Overall funnel throughput (conversions / impressions) for ranking campaigns

